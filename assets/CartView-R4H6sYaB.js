import{_ as H,j as J,k as X,f as b,q as G,g as K,r as V,o as i,c as d,b as w,w as k,a as t,F as P,m as S,p as U,z as T,E as j,i as B,d as v,t as m,D}from"./index-CP4Mrudi.js";import{a as g}from"./axios-G2rPRu76.js";import{u as W}from"./cartStore-ayfO5okx.js";import{u as Y}from"./toastMessage-Cq4jzKej.js";import{_ as Z}from"./ToastMessages-wclNYnoh.js";import{_ as tt}from"./loading-bneA9sLj.js";const E="/week8/assets/loadingCoupon-TC52J2Xe.gif",ot="/week8/assets/empty-cart-Cdy4DvIF.png";var et={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const st={setup(){const{VITE_APP_URL:a,VITE_APP_PATH:n}=et,I=J(),e=X(),L=W(),M=Y(),{pushMessage:u}=M,{getCart:_}=L,C=b([]),o=b(e.params.productId),l=b({}),p=b({loadingItem:""}),q=b(!1),$=()=>{const{category:s=""}=e.query,c=`${a}/api/${n}/products?category=${s}`;q.value=!0,g.get(c).then(r=>{C.value=r.data.products,q.value=!1})},N=s=>{I.push(`/product/${s.id}`).then(()=>{window.scrollTo(0,0)})},y=b(localStorage.getItem("coupon_code")||""),x=b(!1),R=()=>{if(y.value==="purchasesover200010%"&&l.value.total<2e3){u({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}const s=`${a}/api/${n}/coupon`,c={code:y.value};y.value!==""&&(x.value=!0,g.post(s,{data:c}).then(r=>{u({style:"success",title:"加入優惠券",content:r.data.message}),_(),x.value=!1}).catch(r=>{x.value=!1,u({style:"danger",title:"優惠券不可用",content:r.response.data.message})}),localStorage.setItem("coupon_code",y.value))},A=()=>{if(y.value==="purchasesover200010%"&&l.value.total<2e3){u({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}I.push("/order"),window.scrollTo(0,0)},f=()=>{const s=`${a}/api/${n}/cart`;g.get(s).then(c=>{l.value=c.data.data})},F=(s,c=1)=>{const r={product_id:s.product_id,qty:c};p.value.loadingItem=s.id;const h=`${a}/api/${n}/cart/${s.id}`;g.put(h,{data:r}).then(()=>{p.value.loadingItem="",f()})},O=s=>{p.value.loadingItem=s;const c={product_id:s,qty:1},r=`${a}/api/${n}/cart`;g.post(r,{data:c}).then(h=>{p.value.loadingItem="",u({style:"success",title:"加入購物車",content:h.data.message}),_(),f()})},Q=s=>{p.value.loadingItem=s;const c=`${a}/api/${n}/cart/${s}`;g.delete(c).then(r=>{p.value.loadingItem="",u({style:"success",title:"刪除成功",content:r.data.message}),_(),f()})},z=s=>{const c=`${a}/api/${n}/cart/${s.id}`,r={product_id:s.product_id,qty:s.qty};g.put(c,{data:r}).then(h=>{u({style:"success",title:"更新購物車",content:h.data.message}),_()}).catch(h=>{u({style:"danger",title:"更新購物車",content:h.response.data.message})})};return G(()=>l.value,()=>{f()}),K(()=>{_(),f(),$()}),{products:C,id:o,openModal:N,carts:l,status:p,isLoading:q,isLoadingCoupon:x,changeCartQty:F,addCouponCode:R,coupon_code:y,goToOrder:A,removeCartItem:Q,addToCart:O,getProducts:$,getCartList:f,updateCart:z}},components:{ToastMessages:Z}},nt=t("img",{src:tt,width:"500",alt:"loading",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},null,-1),lt=t("div",{class:"container mt-7 p-0"},[t("nav",{"aria-label":"breadcrumb"},[t("ol",{class:"breadcrumb"},[t("li",{class:"breadcrumb-item active","aria-current":"page"},"購物車")])])],-1),it={class:"container mt-5"},dt={key:0,class:"row"},at={class:"table align-middle border-lightBrown pc"},ct=t("thead",null,[t("tr",{class:"text-center"},[t("th",{width:"200"},"商品名稱"),t("th",{width:"120"},"單價"),t("th",{width:"200",class:"text-center"},"數量"),t("th",{width:"200"},"小計"),t("th",{width:"100"},"刪除")])],-1),rt={class:"text-center"},ut=["src"],_t={class:"input-group w-100"},pt=["disabled","onClick"],ht=t("span",{style:{height:"16px",width:"16px"}},"-",-1),bt=[ht],mt=["onClick"],gt=t("span",{style:{height:"16px",width:"16px"}},[t("i",{class:"bi bi-trash"})],-1),yt=[gt],ft=["onUpdate:modelValue","disabled"],vt=["onClick"],wt=t("span",{style:{height:"16px",width:"16px"}},"+",-1),Ct=[wt],xt=["onClick"],kt={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Tt=t("i",{class:"bi bi-trash"},null,-1),It={class:"border-white"},qt=t("td",null,null,-1),Vt={colspan:"2",class:"pt-4 p-0"},Bt=t("i",{class:"bi bi-ticket-perforated fs-2 text-brown pe-3"},null,-1),Lt=t("option",{value:"",disabled:""},"請輸入優惠券",-1),Mt=t("option",{value:"newMember20%"},"新會員首購八折優惠",-1),$t=t("option",{value:"purchasesover200010%"}," 滿兩千享九折優惠 ",-1),Pt=[Lt,Mt,$t],St={type:"submit",class:"btn btn-outline-brown border-lightBrown ms-3 p-2"},Ut={key:0,src:E,alt:"loading",width:"20"},jt=t("td",null,null,-1),Dt={class:"text-black mt-3 pe-7 text-end fs-5"},Et={class:"border-white"},Nt=t("td",null,null,-1),Rt=t("td",null,null,-1),At=t("td",null,null,-1),Ft=t("td",null,null,-1),Ot={class:"p-3"},Qt={class:"d-flex justify-content-center align-items-center p-0"},zt={class:"d-flex justify-content-center align-items-center p-0",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #e9b888"}},Ht={class:"mobile"},Jt={class:"row"},Xt={class:"col-3"},Gt=["src"],Kt={class:"col-4"},Wt={class:"col-5"},Yt={class:"input-group w-100 pt-4"},Zt=["disabled","onClick"],to=t("span",{style:{height:"16px",width:"16px"}},"-",-1),oo=[to],eo=["onClick"],so=t("span",{style:{height:"16px",width:"16px"}},[t("i",{class:"bi bi-trash"})],-1),no=[so],lo=["onUpdate:modelValue","disabled"],io=["onClick"],ao=t("span",{style:{height:"16px",width:"16px"}},"+",-1),co=[ao],ro={class:"border-top border-lightBrown p-3 bg-white"},uo=t("i",{class:"bi bi-ticket-perforated fs-1 text-brown pe-1"},null,-1),_o=t("option",{value:"",disabled:""},"請輸入優惠券",-1),po=t("option",{value:"newMember20%"},"新會員首購八折優惠",-1),ho=t("option",{value:"purchasesover200010%"},"滿兩千享九折優惠",-1),bo=[_o,po,ho],mo={type:"submit",class:"btn btn-outline-brown border-lightBrown p-2"},go={key:0,src:E,alt:"loading",width:"20"},yo={class:"text-black text-end mt-3 fs-5"},fo={class:"d-flex justify-content-end align-items-center my-4"},vo={class:"d-flex justify-content-center align-items-center p-0",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #e9b888"}},wo={key:1,class:"text-center mb-8"},Co=t("img",{src:ot,class:"img-fluid object-fit-cover",alt:"emptycartpicture",style:{width:"300px",height:"350px"}},null,-1),xo={class:"text-brown fs-5"},ko=t("br",null,null,-1);function To(a,n,I,e,L,M){const u=V("VueLoading"),_=V("RouterLink"),C=V("ToastMessages");return i(),d("div",null,[w(u,{active:e.isLoading,"is-full-page":!0,"background-color":"#FFF8F1",opacity:1,"z-index":1060},{default:k(()=>[nt]),_:1},8,["active"]),lt,t("div",it,[e.carts.total!==0?(i(),d("div",dt,[t("table",at,[ct,t("tbody",rt,[(i(!0),d(P,null,S(e.carts.carts,o=>(i(),d("tr",{key:o.id},[t("td",null,[t("div",null,[t("img",{src:o.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,ut)]),w(_,{class:"text-decoration-none text-black",to:`/product/${o.product.id}`},{default:k(()=>[v(m(o.product.title),1)]),_:2},1032,["to"])]),t("td",null,"$"+m(a.$filters.numberToCurrencyNo(o.product.price)),1),t("td",null,[t("div",_t,[o.qty>1?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-lightBrown",disabled:o.qty===1,onClick:l=>{o.qty--,e.changeCartQty(o,o.qty)}},bt,8,pt)):(i(),d("button",{key:1,type:"button",class:"btn btn-outline-brown border-lightBrown",onClick:l=>e.removeCartItem(o.id)},yt,8,mt)),T(t("input",{"onUpdate:modelValue":l=>o.qty=l,type:"number",min:"1",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:o.productId===e.status.loadingItem},null,8,ft),[[D,o.qty]]),t("button",{type:"button",class:"btn btn-outline-lightBrown",onClick:l=>{o.qty++,e.changeCartQty(o,o.qty)}},Ct,8,vt)])]),t("td",null,"$"+m(a.$filters.numberToCurrencyNo(o.total)),1),t("td",null,[t("button",{class:"btn btn-outline-brown border-0",onClick:l=>e.removeCartItem(o.id)},[o.id===e.status.loadingItem?(i(),d("span",kt)):B("",!0),Tt],8,xt)])]))),128))]),t("tfoot",null,[t("tr",It,[qt,t("td",Vt,[t("form",{onSubmit:n[1]||(n[1]=U((...o)=>e.addCouponCode&&e.addCouponCode(...o),["prevent"])),class:"d-flex align-items-center justify-content-end"},[Bt,T(t("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded w-50 p-2 fs-6","onUpdate:modelValue":n[0]||(n[0]=o=>e.coupon_code=o)},Pt,512),[[j,e.coupon_code]]),t("button",St,[t("span",null,[e.isLoadingCoupon?(i(),d("img",Ut)):B("",!0)]),v(" 套用 ")])],32)]),jt,t("td",null,[t("div",Dt," 總計：$"+m(a.$filters.numberToCurrencyNo(e.carts.total))+"元 ",1)])]),t("tr",Et,[Nt,Rt,At,Ft,t("td",Ot,[t("div",Qt,[t("div",zt,[t("a",{class:"loginbtn text-center bg-brown d-block",onClick:n[2]||(n[2]=(...o)=>e.goToOrder&&e.goToOrder(...o))},"立即結帳")])])])])])]),t("div",Ht,[(i(!0),d(P,null,S(e.carts.carts,o=>(i(),d("div",{class:"border-top border-lightBrown p-3 bg-white",key:o.id},[t("div",Jt,[t("div",Xt,[t("img",{src:o.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,Gt)]),t("div",Kt,[w(_,{class:"text-decoration-none text-black",to:`/product/${o.product.id}`},{default:k(()=>[v(m(o.product.title),1)]),_:2},1032,["to"]),t("div",null," $"+m(a.$filters.numberToCurrencyNo(o.total)),1)]),t("div",Wt,[t("div",Yt,[o.qty>1?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-lightBrown",disabled:o.qty===1,onClick:l=>{o.qty--,e.changeCartQty(o,o.qty)}},oo,8,Zt)):(i(),d("button",{key:1,type:"button",class:"btn btn-outline-brown border-lightBrown",onClick:l=>e.removeCartItem(o.id)},no,8,eo)),T(t("input",{"onUpdate:modelValue":l=>o.qty=l,type:"number",min:"1",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:o.productId===e.status.loadingItem},null,8,lo),[[D,o.qty]]),t("button",{type:"button",class:"btn btn-outline-lightBrown",onClick:l=>{o.qty++,e.changeCartQty(o,o.qty)}},co,8,io)])])])]))),128)),t("div",ro,[t("form",{onSubmit:n[4]||(n[4]=U((...o)=>e.addCouponCode&&e.addCouponCode(...o),["prevent"])),class:"d-flex align-items-center justify-content-between"},[uo,T(t("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded p-2 fs-6","onUpdate:modelValue":n[3]||(n[3]=o=>e.coupon_code=o)},bo,512),[[j,e.coupon_code]]),t("button",mo,[t("span",null,[e.isLoadingCoupon?(i(),d("img",go)):B("",!0)]),v(" 套用 ")])],32),t("div",yo," 總計：$"+m(a.$filters.numberToCurrencyNo(e.carts.total))+"元 ",1),t("div",fo,[t("div",vo,[t("a",{class:"loginbtn text-center bg-brown d-block",onClick:n[5]||(n[5]=(...o)=>e.goToOrder&&e.goToOrder(...o))},"立即結帳")])])])])])):(i(),d("div",wo,[Co,t("div",xo,[v(" 購物車還沒有商品呦~ "),ko,w(_,{to:"/products",class:"btn btn-brown text-decoration-none m-3",onclick:"window.scrollTo(0, 0)"},{default:k(()=>[v("按我去選購")]),_:1})])]))]),w(C)])}const $o=H(st,[["render",To]]);export{$o as default};
