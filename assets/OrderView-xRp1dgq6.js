import{f as u,k as A,v as B,g as D,r as f,o as p,c as h,a as e,F as V,p as M,d as y,t as r,b as o,w as S,n as m,z as I,B as L}from"./index-gh1Wuwja.js";import{a as k}from"./axios-G2rPRu76.js";import{u as N}from"./cartStore-hNeT1rAu.js";import{C as q}from"./CouponModal--HaMuo5G.js";import"./toastMessage-gtw7JEM3.js";var O={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const j=e("div",{class:"container mt-8 p-0"},[e("nav",{"aria-label":"breadcrumb"},[e("ol",{class:"breadcrumb"},[e("li",{class:"breadcrumb-item active","aria-current":"page"},"結帳")])])],-1),F={class:"container mt-5"},z={class:"row"},H={class:"table align-middle border-bottom border-lightBrown m-0"},G=e("thead",null,[e("tr",null,[e("th",{width:"2%"}),e("th",{width:"30%"},"訂單商品"),e("th",{width:"8%"}),e("th",{width:"20%"},"單價"),e("th",{width:"20%"},"數量"),e("th",{width:"20%"},"小計")])],-1),J=e("td",null,null,-1),K=["src"],Q=e("br",null,null,-1),W=e("td",null,null,-1),X=e("td",null,[e("div",{class:"form-check"})],-1),Y=e("td",null,null,-1),Z=e("td",{class:"text-lightBrown"},null,-1),ee={colspan:"3",class:"text-end"},se={class:"text-brown fs-5"},le={class:"row justify-content-center bg-white p-2"},te=e("h5",{class:"my-5"},"購買人資料",-1),oe={class:"row"},ae={class:"col-md-6 col-12"},ne={class:"mb-4"},de=e("label",{for:"name",class:"form-label"},"姓名",-1),re={class:"mb-4"},ie=e("label",{for:"tel",class:"form-label"},"電話",-1),ce={class:"mb-4"},ue=e("label",{for:"email",class:"form-label"},"Email",-1),me={class:"col-md-6 col-12"},_e={class:"mb-4"},fe=e("label",{for:"address",class:"form-label"},"地址",-1),pe={class:"mb-4"},he=e("label",{for:"message",class:"form-label"},"留言",-1),ve=e("div",{class:"text-end py-5"},[e("button",{type:"submit",class:"btn p-0 border-0"},[e("div",{class:"d-flex justify-content-center align-items-center p-0",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #A2672D"}},[e("div",{class:"loginbtn text-center bg-brown d-block"},[e("div",null,"送出訂單")])])])],-1),ke={__name:"OrderView",setup(be){const{VITE_APP_URL:v,VITE_APP_PATH:b}=O,P=N(),{getCart:C}=P,i=u({}),g=()=>{const d=`${v}/api/${b}/cart`;k.get(d).then(s=>{i.value=s.data.data})},E=u(null),_=u(null),l=u({user:{name:"",email:"",tel:"",address:""},message:""}),R=A(),T=()=>{const d=`${v}/api/${b}/order`,s=l.value;k.post(d,{data:s}).then(n=>{_.value&&_.value.resetForm(),R.push(`/completed/${n.data.orderId}`)}).catch(n=>{alert(n.response.data.message)}),window.scrollTo(0,0)},U=d=>/^(09)[0-9]{8}$/.test(d)?!0:"需要正確的電話號碼";return B(()=>i.value,()=>{g()}),D(()=>{C(),g()}),(d,s)=>{var w,x;const n=f("v-field"),c=f("error-message"),$=f("v-form");return p(),h(V,null,[j,e("div",F,[e("div",z,[e("table",H,[G,e("tbody",null,[(p(!0),h(V,null,M(i.value.carts,t=>(p(),h("tr",{key:t.id},[J,e("td",null,[e("img",{src:t.product.imageUrl,class:"img-fluid object-fit-cover pe-3",style:{width:"80px",height:"80px"},alt:""},null,8,K),Q,y(" "+r(t.product.title),1)]),W,e("td",null,"$"+r(t.product.price),1),e("td",null,r(t.qty),1),e("td",null,"$"+r(t.final_total),1)]))),128))]),e("tfoot",null,[e("tr",null,[X,Y,Z,e("td",ee,[y("訂單金額("+r((x=(w=i.value)==null?void 0:w.carts)==null?void 0:x.length)+"商品):",1),e("span",se,"$"+r(i.value.final_total),1)])])])])]),e("div",le,[o($,{ref_key:"formRef",ref:_,class:"col-md-10 form-floating",onSubmit:T},{default:S(({errors:t})=>[te,e("div",oe,[e("div",ae,[e("div",ne,[de,o(n,{id:"name",name:"name",type:"text",class:m(["form-control",{"is-invalid":t.name}]),placeholder:"請輸入收件人姓名",rules:"required",modelValue:l.value.user.name,"onUpdate:modelValue":s[0]||(s[0]=a=>l.value.user.name=a)},null,8,["class","modelValue"]),o(c,{name:"name",class:"invalid-feedback"})]),e("div",re,[ie,o(n,{id:"tel",name:"tel",type:"text",class:m(["form-control",{"is-invalid":t.tel}]),placeholder:"請輸入收件人電話",rules:U,modelValue:l.value.user.tel,"onUpdate:modelValue":s[1]||(s[1]=a=>l.value.user.tel=a)},null,8,["class","modelValue"]),o(c,{name:"tel",class:"invalid-feedback"})]),e("div",ce,[ue,o(n,{id:"email",name:"email",type:"email",class:m(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.value.user.email,"onUpdate:modelValue":s[2]||(s[2]=a=>l.value.user.email=a)},null,8,["class","modelValue"]),o(c,{name:"email",class:"invalid-feedback"})])]),e("div",me,[e("div",_e,[fe,o(n,{id:"address",name:"address",type:"text",class:m(["form-control",{"is-invalid":t.address}]),placeholder:"請輸入收件人地址",rules:"required",modelValue:l.value.user.address,"onUpdate:modelValue":s[3]||(s[3]=a=>l.value.user.address=a)},null,8,["class","modelValue"]),o(c,{name:"address",class:"invalid-feedback"})]),e("div",pe,[he,I(e("textarea",{name:"",id:"message",class:"form-control",cols:"20",rows:"5","onUpdate:modelValue":s[4]||(s[4]=a=>l.value.message=a)},null,512),[[L,l.value.message]])])])]),ve]),_:1},512)])]),o(q,{ref_key:"CouponModalRef",ref:E},null,512)],64)}}};export{ke as default};
