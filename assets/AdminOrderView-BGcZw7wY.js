import{f as u,s as T,o as l,c as a,a as e,t as o,j as V,F as b,m as w,y as O,K as D,r as U,b as $,n as I}from"./index-chrp63HQ.js";import{a as P}from"./axios-G2rPRu76.js";import{u as B}from"./toastMessage-jeIKEn4C.js";import{u as N,_ as j}from"./DelModal-Z3Xg0Wv8.js";import{_ as q}from"./PaginationComponent-nJqS11Mi.js";const z={class:"modal-dialog modal-xl",role:"document"},F={class:"modal-content border-0"},H=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},G={class:"row"},J={class:"col-md-4"},Q=e("h3",null,"用戶資料",-1),W={class:"table"},X={key:0},Y=e("th",{style:{width:"100px"}},"姓名",-1),Z=e("th",null,"Email",-1),ee=e("th",null,"電話",-1),te=e("th",null,"地址",-1),se={class:"col-md-8"},le=e("h3",null,"訂單細節",-1),ae={class:"table"},oe=e("th",{style:{width:"100px"}},"訂單編號",-1),ne=e("th",null,"下單時間",-1),de=e("th",null,"付款時間",-1),ie={key:0},ue={key:1},ce=e("th",null,"付款狀態",-1),re={key:0,class:"text-success"},_e={key:1,class:"text-muted"},he=e("th",null,"總金額",-1),pe=e("h3",null,"選購商品",-1),ve={class:"table"},me=e("thead",null,[e("tr")],-1),fe={class:"text-end"},be={class:"d-flex justify-content-end"},ye={class:"form-check"},ke={class:"form-check-label",for:"flexCheckDefault"},$e={key:0},ge={key:1},xe={class:"modal-footer"},Me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Ce={__name:"OrderModal",props:{order:Object},emits:["update-paid"],setup(E,{expose:g,emit:_}){const{openModal:v,hideModal:m,modalRef:f}=N(),x=E,y=_,t=u({});return T(()=>x.order,n=>{t.value=n}),g({openModal:v,hideModal:m}),(n,h)=>(l(),a("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:f},[e("div",z,[e("div",F,[H,e("div",K,[e("div",G,[e("div",J,[Q,e("table",W,[t.value.user?(l(),a("tbody",X,[e("tr",null,[Y,e("td",null,o(t.value.user.name),1)]),e("tr",null,[Z,e("td",null,o(t.value.user.email),1)]),e("tr",null,[ee,e("td",null,o(t.value.user.tel),1)]),e("tr",null,[te,e("td",null,o(t.value.user.address),1)])])):V("",!0)])]),e("div",se,[le,e("table",ae,[e("tbody",null,[e("tr",null,[oe,e("td",null,o(t.value.id),1)]),e("tr",null,[ne,e("td",null,o(n.$filters.date(t.value.create_at)),1)]),e("tr",null,[de,e("td",null,[t.value.paid_date?(l(),a("span",ie,o(n.$filters.date(t.value.paid_date)),1)):(l(),a("span",ue,"時間不正確"))])]),e("tr",null,[ce,e("td",null,[t.value.is_paid?(l(),a("strong",re,"已付款")):(l(),a("span",_e,"尚未付款"))])]),e("tr",null,[he,e("td",null,o(n.$filters.currency(t.value.total)),1)])])]),pe,e("table",ve,[me,e("tbody",null,[(l(!0),a(b,null,w(t.value.products,i=>(l(),a("tr",{key:i.id},[e("th",null,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",fe,o(n.$filters.currency(i.final_total)),1)]))),128))])]),e("div",be,[e("div",ye,[O(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":h[0]||(h[0]=i=>t.value.is_paid=i)},null,512),[[D,t.value.is_paid]]),e("label",ke,[t.value.is_paid?(l(),a("span",$e,"已付款")):(l(),a("span",ge,"未付款"))])])])])])]),e("div",xe,[Me,e("button",{type:"button",class:"btn btn-primary",onClick:h[1]||(h[1]=i=>y("update-paid",t.value))}," 修改付款狀態 ")])])])],512))}};var Pe={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Ve={class:"container"},we={class:"table mt-4"},Ee=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Re=["textContent"],Oe={class:"list-unstyled"},De={class:"text-right"},Le={class:"form-check form-switch"},Ae=["id","onUpdate:modelValue","onChange"],Se=["for"],Te={key:0},Ue={key:1},Ie={class:"btn-group"},Be=["onClick"],Ne=["onClick"],Ke={__name:"AdminOrderView",setup(E){const g=B(),{pushMessage:_}=g,v=u(null),m=u(null),f=u({}),x=u(!1),y=u({}),t=u(!1),n=u({}),h=u({}),i=u(1),{VITE_APP_URL:M,VITE_APP_PATH:C}=Pe,k=(d=1)=>{const p=`${M}/api/${C}/admin/orders?page=${d}`;t.value=!0,P.get(p,h).then(r=>{f.value=r.data.orders,y.value=r.data.pagination,t.value=!1}).catch(r=>{t.value=!1,_({style:"danger",title:"錯誤訊息",content:r.response.data.message})})},L=d=>{n.value={...d},x.value=!1,v.value.openModal()},A=d=>{n.value={...d},m.value.openModal()},R=d=>{const p=`${M}/api/${C}/admin/order/${d.id}`,r={is_paid:d.is_paid};t.value=!0,P.put(p,{data:r}).then(s=>{t.value=!1,v.value.hideModal(),k(i.value),_({style:"success",title:"更新付款狀態",content:s.data.message})}).catch(s=>{t.value=!1,_({style:"danger",title:"錯誤訊息",content:s.response.data.message})})},S=()=>{const d=`${M}/api/${C}/admin/order/${n.value.id}`;t.value=!0,P.delete(d).then(()=>{t.value=!1,m.value.hideModal(),k(i.value)}).catch(p=>{t.value=!1,_({style:"danger",title:"錯誤訊息",content:p.response.data.message})})};return k(),(d,p)=>{const r=U("VueLoading");return l(),a(b,null,[$(r,{active:t.value,"z-index":1060},null,8,["active"]),e("div",Ve,[e("table",we,[Ee,e("tbody",null,[(l(!0),a(b,null,w(f.value,s=>(l(),a(b,{key:s.id},[f.value.length?(l(),a("tr",{key:0,class:I({"text-secondary":!s.is_paid})},[e("td",null,o(d.$filters.date(s.create_at)),1),e("td",null,[s.user?(l(),a("span",{key:0,textContent:o(s.user.email)},null,8,Re)):V("",!0)]),e("td",null,[e("ul",Oe,[(l(!0),a(b,null,w(s.products,c=>(l(),a("li",{key:c.id},o(c.product.title)+" 數量："+o(c.qty)+" "+o(c.product.unit),1))),128))])]),e("td",De,o(s.total),1),e("td",null,[e("div",Le,[O(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.id}`,"onUpdate:modelValue":c=>s.is_paid=c,onChange:c=>R(s)},null,40,Ae),[[D,s.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${s.id}`},[s.is_paid?(l(),a("span",Te,"已付款")):(l(),a("span",Ue,"未付款"))],8,Se)])]),e("td",null,[e("div",Ie,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>L(s)}," 檢視 ",8,Be),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>A(s)}," 刪除 ",8,Ne)])])],2)):V("",!0)],64))),128))])]),$(Ce,{order:n.value,ref_key:"orderModalRef",ref:v,onUpdatePaid:R},null,8,["order"]),$(j,{item:n.value,ref_key:"delModalRef",ref:m,onDelItem:S},null,8,["item"]),$(q,{pages:y.value,onEmitPages:k},null,8,["pages"])])],64)}}};export{Ke as default};
