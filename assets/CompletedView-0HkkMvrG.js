import{P as O,N as $,S as D,a as L}from"./pagination-hurwVTjr.js";import{_ as U,k as j,l as q,f as h,g as F,r as f,o as r,c as a,a as t,q as C,F as y,m as I,d as m,t as o,j as x,b as M,w as V,p as H}from"./index-chrp63HQ.js";import{a as p}from"./axios-G2rPRu76.js";import{u as z}from"./cartStore-4VNCE_vT.js";import{u as G}from"./toastMessage-jeIKEn4C.js";import{_ as J}from"./ToastMessages-A2Jk37eF.js";var K={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Q={setup(){const{VITE_APP_URL:c,VITE_APP_PATH:i}=K,k=j(),e=q(),P=z(),T=G(),{pushMessage:l}=T,{getCart:u}=P,b=h(e.params.productId),_=h([]),s=h({loadingItem:""}),g=()=>{p.get(`${c}/api/${i}/products`).then(n=>{_.value=n.data.products}).catch(n=>{alert(n.response.data.message)})},E=n=>{k.push(`/product/${n.id}`).then(()=>{window.scrollTo(0,0)})},B=n=>{s.value.loadingItem=n;const d={product_id:n,qty:1},R=`${c}/api/${i}/cart`;p.post(R,{data:d}).then(N=>{s.value.loadingItem="",l({style:"success",title:"加入購物車",content:N.data.message}),u()})},v=h(e.params.orderId),S=h({user:{}}),w=()=>{const n=`${c}/api/${i}/order/${v.value}`;p.get(n).then(d=>{S.value=d.data.order}).catch(d=>{l({style:"danger",title:"錯誤訊息",content:d.response.data.message})})},A=()=>{const n=`${c}/api/${i}/pay/${v.value}`;p.post(n).then(()=>{w()}).catch(d=>{l({style:"danger",title:"錯誤訊息",content:d.response.data.message})}),window.scrollTo(0,0)};return w(),F(()=>{g()}),{modules:[O,$],products:_,openModal:E,addToCart:B,getOrder:w,getCart:u,id:b,status:s,order:S,orderId:v,payOrder:A}},components:{Swiper:D,SwiperSlide:L,ToastMessages:J}},W={class:"container mt-8 p-0"},X={"aria-label":"breadcrumb"},Y={class:"breadcrumb"},Z={key:0,class:"breadcrumb-item active","aria-current":"page"},tt={key:1,class:"breadcrumb-item active","aria-current":"page"},st={class:"container mt-5"},et={class:"row"},ot={class:"table align-middle border-bottom border-lightBrown m-0"},rt=t("thead",null,[t("tr",null,[t("th",{width:"2%"}),t("th",{width:"30%"},"訂單商品"),t("th",{width:"8%"}),t("th",{width:"20%"},"單價"),t("th",{width:"20%"},"數量"),t("th",{width:"20%"},"小計")])],-1),at=t("td",null,null,-1),nt=["src"],it=t("td",null,null,-1),dt=t("td",null,[t("div",{class:"form-check"})],-1),ct=t("td",null,null,-1),lt=t("td",{class:"text-lightBrown"},null,-1),_t={colspan:"4",class:"text-end"},ht={class:"text-brown fs-5"},ut={class:"row justify-content-center bg-white px-8 py-6"},pt={class:"col-md-6"},mt={class:"mb-3"},bt={class:"mb-3"},gt={class:"mb-3"},vt={class:"mb-3"},wt={class:"col-md-6"},ft=t("div",{class:"mb-3"},"留言",-1),yt={class:"border border-1 rounded p-2 mb-3 w-100",style:{height:"100px"}},xt={class:"text-end"},kt={key:0,class:"text-danger"},Pt={key:1,class:"text-success"},Tt={key:0,class:"p-3 bg-white row border-top border-1 border-lightBrown"},St=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn p-0 border-0"},[t("div",{class:"d-flex justify-content-center align-items-center p-0",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #e9b888"}},[t("button",{type:"submit",class:"loginbtn text-center bg-lightBrown border-0"},"確認付款去")])])],-1),Ct=[St],It={class:"container mt-8 p-0"},Mt=t("h3",{class:"text-center text-brown"},[m(" 猜你喜歡 "),t("div",{class:"text-center text-brown m-0 p-0 fs-1"},"-")],-1),Vt={id:"swiper"},Et={class:"col-md-9"},Bt=["onClick"],At={key:0,class:"position-absolute top-0 start-0 fw-bold text-white p-2 bg-brown rounded-top"},Rt=["src"],Nt={class:"card-body"},Ot={class:"card-title"},$t={key:0,class:"text-gray2 fs-5 card-title"},Dt={key:1,class:"d-flex align-items-center card-title ms-2"},Lt={class:"text-gray2 fs-5"},Ut={class:"text-brown fs-4 ms-3"},jt=["onClick"],qt={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Ft=t("i",{class:"bi bi-cart-plus"},null,-1);function Ht(c,i,k,e,P,T){var _;const l=f("swiper-slide"),u=f("swiper"),b=f("ToastMessages");return r(),a(y,null,[t("div",W,[t("nav",X,[t("ol",Y,[e.order.is_paid===!0?(r(),a("li",Z," 訂單完成!感謝您的購買! ")):(r(),a("li",tt,"待付款訂單"))])])]),t("div",st,[t("form",{onSubmit:i[0]||(i[0]=C((...s)=>e.payOrder&&e.payOrder(...s),["prevent"]))},[t("div",et,[t("table",ot,[rt,t("tbody",null,[(r(!0),a(y,null,I(e.order.products,s=>(r(),a("tr",{key:s.id},[at,t("td",null,[t("img",{src:s.product.imageUrl,style:{width:"80px",height:"80px"},alt:""},null,8,nt),m(" "+o(s.product.title),1)]),it,t("td",null,"$"+o(s.product.price),1),t("td",null,o(s.qty),1),t("td",null,"$"+o(s.final_total),1)]))),128))]),t("tfoot",null,[t("tr",null,[dt,ct,lt,t("td",_t,[m("訂單金額("+o((_=e.order.products)==null?void 0:_.length)+"商品):",1),t("span",ht,"$"+o(e.order.total),1)])])])])]),t("div",ut,[t("div",pt,[t("div",mt,"送貨地址:"+o(e.order.user.address),1),t("div",bt,"Email:"+o(e.order.user.email),1),t("div",gt,"顧客姓名:"+o(e.order.user.name),1),t("div",vt,"電話:"+o(e.order.user.tel),1)]),t("div",wt,[ft,t("div",yt,o(e.order.message),1)]),t("div",xt,[m("付款狀態 "),e.order.is_paid?(r(),a("span",Pt,"付款完成")):(r(),a("span",kt,"尚未付款"))])]),e.order.is_paid===!1?(r(),a("div",Tt,Ct)):x("",!0)],32)]),t("div",It,[Mt,t("div",Vt,[M(u,{slidesPerView:2,grabCursor:!0,pagination:{clickable:!0},modules:e.modules,class:"mySwiper",navigation:!0,mousewheel:!0,keyboard:!0},{default:V(()=>[(r(!0),a(y,null,I(e.products,s=>(r(),H(l,{key:s.id},{default:V(()=>[t("div",Et,[t("div",{class:"card shadow-sm bg-body rounded-lg border-0 position-relative mb-5 col-12 ms-3 p-0",onClick:g=>e.openModal(s)},[s.price!==s.origin_price?(r(),a("span",At,"SALE")):x("",!0),t("img",{src:s.imageUrl,class:"card-img-top object-fit-cover w-100",style:{height:"300px"},alt:"productPicture"},null,8,Rt),t("div",Nt,[t("p",Ot,o(s.title),1),s.price===s.origin_price?(r(),a("div",$t," $"+o(s.origin_price),1)):(r(),a("div",Dt,[t("del",Lt,"$"+o(s.origin_price),1),t("div",Ut,"$"+o(s.price),1)])),t("button",{type:"button",class:"btn btn-outline-brown border-0 fs-5 m-2 position-absolute bottom-0 end-0",onClick:C(g=>e.addToCart(s.id,1),["stop"])},[s.id===e.status.loadingItem?(r(),a("span",qt)):x("",!0),Ft],8,jt)])],8,Bt)])]),_:2},1024))),128))]),_:1},8,["modules"])])]),M(b)],64)}const Xt=U(Q,[["render",Ht]]);export{Xt as default};
