import{_ as x,f as r,s as R,g as E,M as C,o as d,c as n,a as t,d as A,j as H,y as b,A as h,F as I,m as D,K as B,t as P,k as O,r as k,b as w,n as j}from"./index-chrp63HQ.js";import{a as g}from"./axios-G2rPRu76.js";import{_ as z}from"./PaginationComponent-nJqS11Mi.js";var $={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:M}=$,{VITE_APP_PATH:V}=$,N={props:["status","product","updateProduct"],setup(i,{emit:e}){const l=r(null),o=r(null),u=r({}),a=r({}),s=()=>{l.value.show()},_=()=>{l.value.hide()},f=()=>{let v=`${M}/api/${V}/admin/product`,y="post";i.status||(v=`${M}/api/${V}/admin/product/${i.product.id}`,y="put"),g[y](v,{data:i.product}).then(U=>{alert(U.data.message),e("update"),_()}).catch(U=>{alert(U.response.data.message)})},c=()=>{u.value.imagesUrl=[],u.value.imagesUrl.push("")},m=r(null),p=r({fileUploading:!1}),S=()=>{const v=m.value.files[0],y=new FormData;y.append("file-to-upload",v);const U=`${M}/api/${V}/admin/upload`;p.value.fileUploading=!0,g.post(U,y,{headers:{"Content-Type":"multipart/form-data"}}).then(F=>{p.value.fileUploading=!1,a.value.imageUrl=F.data.imageUrl,m.value.value=""}).catch(()=>{p.value.fileUploading=!1})};return R(()=>i.product,v=>{a.value=v,a.value.imagesUrl||(a.value.imagesUrl=[]),a.value.imageUrl||(a.value.imageUrl="")}),R(()=>i.product,()=>{u.value=i.product}),E(()=>{l.value=new C(o.value,{keyboard:!1,backdrop:"static"}),u.value=i.product}),{updateProduct:f,createImages:c,oModal:s,cModal:_,pModalRef:o,editProduct:u,tempProduct:a,fileInputRef:m,uploadFile:S}}},K={class:"modal",tabindex:"-1",id:"productModal",ref:"pModalRef","aria-labelledby":"productModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-xl"},G={class:"modal-content"},J={class:"modal-header bg-dark text-white"},Q={class:"modal-title"},W={key:0},X={key:1},Y=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Z={class:"modal-body"},tt={class:"row"},ot={class:"col-md-4"},et={class:"mb-3"},st=t("h3",null,"主要圖片",-1),lt={for:"customFile",class:"form-label"},at={key:0,class:"fas fa-spinner fa-spin"},dt=["src"],nt={class:"row"},it={class:"mb-3"},ct=t("label",{for:"imageUrl",class:"col-form-label"},"圖片網址",-1),rt=["src"],ut=t("h3",null,"多圖新增",-1),_t={key:0,class:"mb-3"},mt=t("label",{for:"imagesUrl",class:"col-form-label"},"圖片網址",-1),pt=["onUpdate:modelValue"],bt=["src"],ht={key:0},ft={key:1},vt={key:1},Pt=t("div",{class:"mb-3"},null,-1),gt={class:"col-md-8"},yt={class:"row"},Ut={class:"mb-3"},kt=t("label",{for:"title",class:"col-form-label"},"標題",-1),wt={class:"row"},Mt={class:"col-md-6 mb-3"},Vt=t("label",{for:"category",class:"col-form-label"},"分類",-1),At={class:"col-md-6 mb-3"},xt=t("label",{for:"unit",class:"col-form-label"},"單位",-1),Et={class:"row"},Rt={class:"col-md-6 mb-3"},Tt=t("label",{for:"origin_price",class:"col-form-label"},"原價",-1),Ct={class:"col-md-6 mb-3"},It=t("label",{for:"price",class:"col-form-label"},"售價",-1),Dt={class:"row mb-3"},$t=t("label",{for:"description",class:"col-form-label"},"商品描述",-1),Lt={class:"row mb-3"},St=t("label",{for:"content",class:"col-form-label"},"商品內容",-1),Ft={class:"form-check"},Ht=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Bt={class:"modal-footer"},Ot=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function jt(i,e,l,o,u,a){return d(),n("div",K,[t("div",q,[t("div",G,[t("div",J,[t("h5",Q,[l.status?(d(),n("span",W,"新增產品")):(d(),n("span",X,"編輯產品"))]),Y]),t("div",Z,[t("div",tt,[t("div",ot,[t("div",et,[st,t("label",lt,[A("上傳圖片 "),l.status.fileUploading?(d(),n("i",at)):H("",!0)]),t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInputRef",onChange:e[0]||(e[0]=(...s)=>o.uploadFile&&o.uploadFile(...s))},null,544)]),t("img",{class:"img-fluid",src:o.tempProduct.imageUrl},null,8,dt),t("div",nt,[t("div",it,[ct,b(t("input",{type:"text",class:"form-control mb-3",id:"imageUrl","onUpdate:modelValue":e[1]||(e[1]=s=>o.editProduct.imageUrl=s)},null,512),[[h,o.editProduct.imageUrl]]),t("img",{src:o.editProduct.imageUrl,class:"w-100"},null,8,rt)])]),ut,Array.isArray(o.editProduct.imagesUrl)?(d(),n("div",_t,[(d(!0),n(I,null,D(o.editProduct.imagesUrl,(s,_)=>(d(),n("div",{class:"mb-3",key:_},[mt,b(t("input",{type:"text",class:"form-control mb-3",id:"imagesUrl","onUpdate:modelValue":f=>o.editProduct.imagesUrl[_]=f},null,8,pt),[[h,o.editProduct.imagesUrl[_]]]),t("img",{src:s,class:"w-100"},null,8,bt)]))),128)),!o.editProduct.imagesUrl.length||o.editProduct.imagesUrl[o.editProduct.imagesUrl.length-1]?(d(),n("div",ht,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary d-block w-100",onClick:e[2]||(e[2]=s=>o.editProduct.imagesUrl.push(""))}," 新增圖片 ")])):(d(),n("div",ft,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger d-block w-100",onClick:e[3]||(e[3]=s=>o.editProduct.imagesUrl.pop())}," 刪除圖片 ")]))])):(d(),n("div",vt,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary d-block w-100",onClick:e[4]||(e[4]=(...s)=>o.createImages&&o.createImages(...s))}," 新增圖片 ")])),Pt]),t("div",gt,[t("div",yt,[t("div",Ut,[kt,b(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[5]||(e[5]=s=>o.editProduct.title=s)},null,512),[[h,o.editProduct.title]])])]),t("div",wt,[t("div",Mt,[Vt,b(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":e[6]||(e[6]=s=>o.editProduct.category=s)},null,512),[[h,o.editProduct.category]])]),t("div",At,[xt,b(t("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":e[7]||(e[7]=s=>o.editProduct.unit=s)},null,512),[[h,o.editProduct.unit]])])]),t("div",Et,[t("div",Rt,[Tt,b(t("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":e[8]||(e[8]=s=>o.editProduct.origin_price=s),min:"1"},null,512),[[h,o.editProduct.origin_price,void 0,{number:!0}]])]),t("div",Ct,[It,b(t("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[9]||(e[9]=s=>o.editProduct.price=s),min:"1"},null,512),[[h,o.editProduct.price,void 0,{number:!0}]])])]),t("div",Dt,[$t,b(t("textarea",{class:"form-control white-textarea",id:"description","onUpdate:modelValue":e[10]||(e[10]=s=>o.editProduct.description=s)},null,512),[[h,o.editProduct.description]])]),t("div",Lt,[St,b(t("textarea",{class:"form-control",id:"content","onUpdate:modelValue":e[11]||(e[11]=s=>o.editProduct.content=s)},null,512),[[h,o.editProduct.content]])]),t("div",Ft,[b(t("input",{id:"is_enabled","onUpdate:modelValue":e[12]||(e[12]=s=>o.editProduct.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[B,o.editProduct.is_enabled]]),Ht])])])]),t("div",Bt,[Ot,t("button",{type:"button",class:"btn btn-primary",onClick:e[13]||(e[13]=(...s)=>o.updateProduct&&o.updateProduct(...s))}," 確定 ")])])])],512)}const zt=x(N,[["render",jt]]);var L={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:Nt}=L,{VITE_APP_PATH:Kt}=L,qt={props:["item"],setup(i,{emit:e}){const l=r(null),o=r(null),u=()=>{g.delete(`${Nt}/api/${Kt}/admin/product/${i.item.id}`).then(()=>{e("update"),l.value.hide()}).catch(_=>{alert(_.response.data.message)})},a=()=>{l.value.show()},s=()=>{l.value.hide()};return E(()=>{l.value=new C(o.value,{keyboard:!1,backdrop:"static"})}),{delProduct:u,oModal:a,cModal:s,delProductModalRef:o}}},Gt={class:"modal",tabindex:"-1",id:"delProductModal",ref:"delProductModalRef","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Jt={class:"modal-dialog"},Qt={class:"modal-content"},Wt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{class:"modal-title"},"刪除商品"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Xt={class:"modal-body"},Yt={class:"text-danger"},Zt={class:"modal-footer"},to=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function oo(i,e,l,o,u,a){return d(),n("div",Gt,[t("div",Jt,[t("div",Qt,[Wt,t("div",Xt,[t("p",null,[A(" 是否刪除 "),t("strong",Yt,P(l.item.title),1),A(" 商品(刪除後將無法恢復)。 ")])]),t("div",Zt,[to,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=s=>o.delProduct())}," 確定刪除 ")])])])],512)}const eo=x(qt,[["render",oo]]);var so={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:T,VITE_APP_PATH:lo}=so,ao={setup(){const i=r([]),e=r({imageUrl:[]}),l=r({}),o=r(null),u=r(null),a=r(!1),s=O(),_=(m=1)=>{g.get(`${T}/api/${lo}/admin/products?page=${m}`).then(p=>{i.value=p.data.products,l.value=p.data.pagination}).catch(p=>{alert(p.response.data.message)})},f=()=>{g.post(`${T}/api/user/check`).then(()=>{_()}).catch(()=>{s.push("/login")})},c=(m,p)=>{m==="new"?(e.value={imageUrl:[]},a.value=!0,o.value.oModal()):m==="edit"?(e.value={...p},a.value=!1,o.value.oModal()):m==="delete"&&(e.value={...p},u.value.oModal())};return E(()=>{const m=document.cookie.replace(/(?:(?:^|.*;\s*)rubbyToken\s*=\s*([^;]*).*$)|^.*$/,"$1");g.defaults.headers.common.Authorization=m,f()}),{products:i,tempProduct:e,openModal:c,status:a,getData:_,pagination:l,delModalRef:u,productRef:o}},components:{PaginationComponent:z,DelProductModal:eo,ProductModal:zt}},no={id:"app"},io={class:"container p-0"},co={class:"m-3 d-flex justify-content-end"},ro={class:"row my-3"},uo={class:"table p-0"},_o=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",{width:"150"},"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"150"},"是否啟用"),t("th",{width:"150"},"編輯")])],-1),mo={width:"150"},po={width:"150"},bo={width:"120"},ho={width:"120"},fo={width:"150"},vo={key:1},Po={width:"150"},go=["onClick"],yo=["onClick"],Uo={colspan:"6",class:"border-0"};function ko(i,e,l,o,u,a){const s=k("PaginationComponent"),_=k("ProductModal"),f=k("DelProductModal");return d(),n("div",no,[t("div",io,[t("div",co,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=c=>o.openModal("new"))}," 建立新的產品 ")]),t("div",ro,[t("table",uo,[_o,t("tbody",null,[(d(!0),n(I,null,D(o.products,c=>(d(),n("tr",{key:c.id},[t("td",mo,P(c.category),1),t("td",po,P(c.title),1),t("td",bo,P(c.origin_price),1),t("td",ho,P(c.price),1),t("td",fo,[c.is_enabled?(d(),n("span",{key:0,class:j({"text-success":c.is_enabled})},"啟用",2)):(d(),n("span",vo,"未啟用"))]),t("td",Po,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:m=>o.openModal("edit",c)}," 編輯 ",8,go),t("button",{type:"button",class:"btn btn-outline-danger",onClick:m=>o.openModal("delete",c)}," 刪除 ",8,yo)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",Uo," 目前有"+P(o.products.length)+"項產品 ",1)])])])]),w(s,{pages:o.pagination,onEmitPages:o.getData},null,8,["pages","onEmitPages"])]),w(_,{ref:"productRef",product:o.tempProduct,status:o.status,onUpdate:o.getData},null,8,["product","status","onUpdate"]),w(f,{ref:"delModalRef",item:o.tempProduct,onUpdate:o.getData},null,8,["item","onUpdate"])])}const Ao=x(ao,[["render",ko]]);export{Ao as default};
