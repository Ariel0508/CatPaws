import{_ as H,k as Q,l as z,g as h,v as J,h as X,r as q,o as l,c as d,b as w,w as k,a as t,F as S,n as U,s as j,z as T,E as $,j as V,d as m,t as p,D}from"./index-VSSUrm_l.js";import{a as g}from"./axios-G2rPRu76.js";import{u as G}from"./cartStore-qC1KTVv4.js";import{u as K}from"./toastMessage-JJTYryMe.js";import{_ as W}from"./ToastMessages-uBZpxaA7.js";import{_ as Y}from"./loading-bneA9sLj.js";const E="/week8/assets/loadingCoupon-TC52J2Xe.gif",Z="/week8/assets/empty-cart-Cdy4DvIF.png";var tt={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const et={setup(){const{VITE_APP_URL:a,VITE_APP_PATH:s}=tt,B=Q(),o=z(),L=G(),M=K(),{pushMessage:u}=M,{getCart:_}=L,x=h([]),e=h(o.params.productId),n=h({}),y=h({loadingItem:""}),I=h(!1),P=()=>{const{category:i=""}=o.query,c=`${a}/api/${s}/products?category=${i}`;I.value=!0,g.get(c).then(r=>{x.value=r.data.products,I.value=!1})},b=h(localStorage.getItem("coupon_code")||""),C=h(!1),N=()=>{if(b.value==="purchasesover200010%"&&n.value.total<2e3){u({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}const i=`${a}/api/${s}/coupon`,c={code:b.value};b.value!==""&&(C.value=!0,g.post(i,{data:c}).then(r=>{u({style:"success",title:"加入優惠券",content:r.data.message}),_(),C.value=!1}).catch(r=>{C.value=!1,u({style:"danger",title:"優惠券不可用",content:r.response.data.message})}),localStorage.setItem("coupon_code",b.value))},R=()=>{if(b.value==="purchasesover200010%"&&n.value.total<2e3){u({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}B.push("/order"),window.scrollTo(0,0)},f=()=>{const i=`${a}/api/${s}/cart`;g.get(i).then(c=>{n.value=c.data.data})},A=(i,c=1)=>{const r={product_id:i.product_id,qty:c};y.value.loadingItem=i.id;const v=`${a}/api/${s}/cart/${i.id}`;g.put(v,{data:r}).then(()=>{y.value.loadingItem="",f()})},F=i=>{y.value.loadingItem=i;const c=`${a}/api/${s}/cart/${i}`;g.delete(c).then(r=>{y.value.loadingItem="",u({style:"success",title:"刪除成功",content:r.data.message}),_(),f()})},O=i=>{const c=`${a}/api/${s}/cart/${i.id}`,r={product_id:i.product_id,qty:i.qty};g.put(c,{data:r}).then(v=>{u({style:"success",title:"更新購物車",content:v.data.message}),_()}).catch(v=>{u({style:"danger",title:"更新購物車",content:v.response.data.message})})};return J(()=>n.value,()=>{f()}),X(()=>{_(),f(),P()}),{products:x,id:e,carts:n,status:y,isLoading:I,isLoadingCoupon:C,changeCartQty:A,addCouponCode:N,coupon_code:b,goToOrder:R,removeCartItem:F,getProducts:P,getCartList:f,updateCart:O}},components:{ToastMessages:W}},ot=t("img",{src:Y,width:"500",alt:"loading",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},null,-1),st=t("div",{class:"container mt-7 p-0"},[t("nav",{"aria-label":"breadcrumb"},[t("ol",{class:"breadcrumb"},[t("li",{class:"breadcrumb-item active","aria-current":"page"},"購物車")])])],-1),nt={class:"container mt-5"},it={key:0,class:"row"},lt={class:"table align-middle border-lightBrown pc"},dt=t("thead",null,[t("tr",{class:"text-center"},[t("th",{width:"200"},"商品名稱"),t("th",{width:"120"},"單價"),t("th",{width:"200",class:"text-center"},"數量"),t("th",{width:"200"},"小計"),t("th",{width:"100"},"刪除")])],-1),at={class:"text-center"},ct=["src"],rt={class:"input-group w-100"},ut=["disabled","onClick"],_t=t("span",{style:{height:"16px",width:"16px"}},"-",-1),ht=[_t],pt=["onClick"],bt=t("span",{style:{height:"16px",width:"16px"}},[t("i",{class:"bi bi-trash"})],-1),mt=[bt],gt=["onUpdate:modelValue","disabled"],yt=["onClick"],ft=t("span",{style:{height:"16px",width:"16px"}},"+",-1),vt=[ft],wt=["onClick"],xt={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Ct=t("i",{class:"bi bi-trash"},null,-1),kt={class:"border-white"},Tt=t("td",null,null,-1),It={colspan:"2",class:"pt-4 p-0"},qt=t("i",{class:"bi bi-ticket-perforated fs-2 text-brown pe-3"},null,-1),Vt=t("option",{value:"",disabled:""},"請輸入優惠券",-1),Bt=t("option",{value:"newMember20%"},"新會員首購八折優惠",-1),Lt=t("option",{value:"purchasesover200010%"}," 滿兩千享九折優惠 ",-1),Mt=[Vt,Bt,Lt],Pt={type:"submit",class:"btn btn-outline-brown border-lightBrown ms-3 p-2"},St={key:0,src:E,alt:"loading",width:"20"},Ut=t("td",null,null,-1),jt={class:"text-black mt-3 pe-7 text-end fs-5"},$t={class:"border-white"},Dt=t("td",null,null,-1),Et=t("td",null,null,-1),Nt=t("td",null,null,-1),Rt=t("td",null,null,-1),At={class:"p-3"},Ft={class:"d-flex justify-content-center text-brown"},Ot={class:"d-flex align-items-center justify-content-center btnHover",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #a2672d"}},Ht={class:"mobile"},Qt={class:"row"},zt={class:"col-3"},Jt=["src"],Xt={class:"col-4"},Gt={class:"col-5"},Kt={class:"input-group w-100 pt-4"},Wt=["disabled","onClick"],Yt=t("span",{style:{height:"16px",width:"16px"}},"-",-1),Zt=[Yt],te=["onClick"],ee=t("span",{style:{height:"16px",width:"16px"}},[t("i",{class:"bi bi-trash"})],-1),oe=[ee],se=["onUpdate:modelValue","disabled"],ne=["onClick"],ie=t("span",{style:{height:"16px",width:"16px"}},"+",-1),le=[ie],de={class:"border-top border-lightBrown p-3 bg-white"},ae=t("i",{class:"bi bi-ticket-perforated fs-1 text-brown pe-1"},null,-1),ce=t("option",{value:"",disabled:""},"請輸入優惠券",-1),re=t("option",{value:"newMember20%"},"新會員首購八折優惠",-1),ue=t("option",{value:"purchasesover200010%"},"滿兩千享九折優惠",-1),_e=[ce,re,ue],he={type:"submit",class:"btn btn-outline-brown border-lightBrown p-2"},pe={key:0,src:E,alt:"loading",width:"20"},be={class:"text-black text-end mt-3 fs-5"},me={class:"d-flex justify-content-end text-brown my-3"},ge={class:"d-flex align-items-center justify-content-center btnHover",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #a2672d"}},ye={key:1,class:"text-center mb-8"},fe=t("img",{src:Z,class:"img-fluid object-fit-cover",alt:"emptycartpicture",style:{width:"300px",height:"350px"}},null,-1),ve={class:"text-brown fs-5"},we=t("br",null,null,-1);function xe(a,s,B,o,L,M){const u=q("VueLoading"),_=q("RouterLink"),x=q("ToastMessages");return l(),d("div",null,[w(u,{active:o.isLoading,"is-full-page":!0,"background-color":"#FFF8F1",opacity:1,"z-index":1060},{default:k(()=>[ot]),_:1},8,["active"]),st,t("div",nt,[o.carts.total!==0?(l(),d("div",it,[t("table",lt,[dt,t("tbody",at,[(l(!0),d(S,null,U(o.carts.carts,e=>(l(),d("tr",{key:e.id},[t("td",null,[t("div",null,[t("img",{src:e.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,ct),w(_,{class:"text-decoration-none text-black",to:`/product/${e.product.id}`},{default:k(()=>[m(p(e.product.title),1)]),_:2},1032,["to"])])]),t("td",null,"$"+p(a.$filters.numberToCurrencyNo(e.product.price)),1),t("td",null,[t("div",rt,[e.qty>1?(l(),d("button",{key:0,type:"button",class:"btn btn-outline-lightBrown",disabled:e.qty===1,onClick:n=>{e.qty--,o.changeCartQty(e,e.qty)}},ht,8,ut)):(l(),d("button",{key:1,type:"button",class:"btn btn-outline-brown border-lightBrown",onClick:n=>o.removeCartItem(e.id)},mt,8,pt)),T(t("input",{"onUpdate:modelValue":n=>e.qty=n,type:"number",min:"1",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:e.productId===o.status.loadingItem},null,8,gt),[[D,e.qty]]),t("button",{type:"button",class:"btn btn-outline-lightBrown",onClick:n=>{e.qty++,o.changeCartQty(e,e.qty)}},vt,8,yt)])]),t("td",null,"$"+p(a.$filters.numberToCurrencyNo(e.total)),1),t("td",null,[t("button",{class:"btn btn-outline-brown border-0",onClick:n=>o.removeCartItem(e.id)},[e.id===o.status.loadingItem?(l(),d("span",xt)):V("",!0),Ct],8,wt)])]))),128))]),t("tfoot",null,[t("tr",kt,[Tt,t("td",It,[t("form",{onSubmit:s[1]||(s[1]=j((...e)=>o.addCouponCode&&o.addCouponCode(...e),["prevent"])),class:"d-flex align-items-center justify-content-end"},[qt,T(t("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded w-50 p-2 fs-6","onUpdate:modelValue":s[0]||(s[0]=e=>o.coupon_code=e)},Mt,512),[[$,o.coupon_code]]),t("button",Pt,[t("span",null,[o.isLoadingCoupon?(l(),d("img",St)):V("",!0)]),m(" 套用 ")])],32)]),Ut,t("td",null,[t("div",jt," 總計：$"+p(a.$filters.numberToCurrencyNo(o.carts.total))+"元 ",1)])]),t("tr",$t,[Dt,Et,Nt,Rt,t("td",At,[t("div",Ft,[t("div",Ot,[t("a",{class:"text-center bg-brown text-decoration-none text-white m-1 d-block btnHover",style:{width:"175px",height:"30px","line-height":"30px"},onClick:s[2]||(s[2]=(...e)=>o.goToOrder&&o.goToOrder(...e))},"立即結帳 ")])])])])])]),t("div",Ht,[(l(!0),d(S,null,U(o.carts.carts,e=>(l(),d("div",{class:"border-top border-lightBrown p-3 bg-white",key:e.id},[t("div",Qt,[t("div",zt,[t("img",{src:e.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,Jt)]),t("div",Xt,[w(_,{class:"text-decoration-none text-black",to:`/product/${e.product.id}`},{default:k(()=>[m(p(e.product.title),1)]),_:2},1032,["to"]),t("div",null,"$"+p(a.$filters.numberToCurrencyNo(e.total)),1)]),t("div",Gt,[t("div",Kt,[e.qty>1?(l(),d("button",{key:0,type:"button",class:"btn btn-outline-lightBrown",disabled:e.qty===1,onClick:n=>{e.qty--,o.changeCartQty(e,e.qty)}},Zt,8,Wt)):(l(),d("button",{key:1,type:"button",class:"btn btn-outline-brown border-lightBrown",onClick:n=>o.removeCartItem(e.id)},oe,8,te)),T(t("input",{"onUpdate:modelValue":n=>e.qty=n,type:"number",min:"1",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:e.productId===o.status.loadingItem},null,8,se),[[D,e.qty]]),t("button",{type:"button",class:"btn btn-outline-lightBrown",onClick:n=>{e.qty++,o.changeCartQty(e,e.qty)}},le,8,ne)])])])]))),128)),t("div",de,[t("form",{onSubmit:s[4]||(s[4]=j((...e)=>o.addCouponCode&&o.addCouponCode(...e),["prevent"])),class:"d-flex align-items-center justify-content-between"},[ae,T(t("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded p-2 fs-6","onUpdate:modelValue":s[3]||(s[3]=e=>o.coupon_code=e)},_e,512),[[$,o.coupon_code]]),t("button",he,[t("span",null,[o.isLoadingCoupon?(l(),d("img",pe)):V("",!0)]),m(" 套用 ")])],32),t("div",be," 總計：$"+p(a.$filters.numberToCurrencyNo(o.carts.total))+"元 ",1),t("div",me,[t("div",ge,[t("a",{class:"text-center bg-brown text-decoration-none text-white m-1 d-block",style:{width:"175px",height:"30px","line-height":"30px"},onClick:s[5]||(s[5]=(...e)=>o.goToOrder&&o.goToOrder(...e))},"立即結帳 ")])])])])])):(l(),d("div",ye,[fe,t("div",ve,[m(" 購物車還沒有商品呦~ "),we,w(_,{to:"/products",class:"btn btn-brown text-decoration-none m-3",onclick:"window.scrollTo(0, 0)"},{default:k(()=>[m("按我去選購")]),_:1})])]))]),w(x)])}const Be=H(et,[["render",xe]]);export{Be as default};
