import{N as J,P as W,S as X,a as G}from"./pagination-MIlt1seT.js";import{M as Y,K as Z}from"./mousewheel-JmLWMgor.js";import{_ as tt,j as et,k as ot,f as h,q as st,g as nt,l as it,r as x,o as i,c as l,b as v,w as C,a as t,F as M,m as L,p as $,z as V,E,i as k,d as y,t as u,D,n as lt}from"./index-RFYwpk8Q.js";import{a as g}from"./axios-G2rPRu76.js";import{u as dt}from"./cartStore-o0DpLVZF.js";import{u as at}from"./toastMessage-IJTrlXIm.js";import{_ as rt}from"./ToastMessages-I8qgW9z6.js";import{_ as ct}from"./loading-bneA9sLj.js";const R="/week8/assets/loadingCoupon-TC52J2Xe.gif",ut="/week8/assets/empty-cart-Cdy4DvIF.png";var _t={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const pt={setup(){const{VITE_APP_URL:d,VITE_APP_PATH:n}=_t,q=et(),o=ot(),N=dt(),U=at(),{pushMessage:_}=U,{getCart:p}=N,T=h([]),P=h(o.params.productId),b=h({}),e=h({loadingItem:""}),a=h(!1),j=()=>{const{category:s=""}=o.query,r=`${d}/api/${n}/products?category=${s}`;a.value=!0,g.get(r).then(c=>{T.value=c.data.products,a.value=!1})},A=s=>{q.push(`/product/${s.id}`).then(()=>{window.scrollTo(0,0)})},f=h(localStorage.getItem("coupon_code")||""),I=h(!1),F=()=>{if(f.value==="purchasesover200010%"&&b.value.total<2e3){_({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}const s=`${d}/api/${n}/coupon`,r={code:f.value};f.value!==""&&(I.value=!0,g.post(s,{data:r}).then(c=>{_({style:"success",title:"加入優惠券",content:c.data.message}),p(),I.value=!1}).catch(c=>{I.value=!1,_({style:"danger",title:"優惠券不可用",content:c.response.data.message})}),localStorage.setItem("coupon_code",f.value))},O=()=>{if(f.value==="purchasesover200010%"&&b.value.total<2e3){_({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}q.push("/order"),window.scrollTo(0,0)},w=()=>{const s=`${d}/api/${n}/cart`;g.get(s).then(r=>{b.value=r.data.data})},Q=(s,r=1)=>{const c={product_id:s.product_id,qty:r};e.value.loadingItem=s.id;const m=`${d}/api/${n}/cart/${s.id}`;g.put(m,{data:c}).then(()=>{e.value.loadingItem="",w()})},z=s=>{e.value.loadingItem=s;const r={product_id:s,qty:1},c=`${d}/api/${n}/cart`;g.post(c,{data:r}).then(m=>{e.value.loadingItem="",_({style:"success",title:"加入購物車",content:m.data.message}),p(),w()})},H=s=>{e.value.loadingItem=s;const r=`${d}/api/${n}/cart/${s}`;g.delete(r).then(c=>{e.value.loadingItem="",_({style:"success",title:"刪除成功",content:c.data.message}),p(),w()})},K=s=>{const r=`${d}/api/${n}/cart/${s.id}`,c={product_id:s.product_id,qty:s.qty};g.put(r,{data:c}).then(m=>{_({style:"success",title:"更新購物車",content:m.data.message}),p()}).catch(m=>{_({style:"danger",title:"更新購物車",content:m.response.data.message})})},S=h(4),B=()=>{window.innerWidth<=767?S.value=1:S.value=4};return st(()=>b.value,()=>{w(),p()}),nt(()=>{p(),w(),j(),B(),window.addEventListener("resize",B)}),it(()=>{window.removeEventListener("resize",B)}),{modules:[J,W,Y,Z],products:T,id:P,openModal:A,carts:b,status:e,isLoading:a,isLoadingCoupon:I,changeCartQty:Q,addCouponCode:F,coupon_code:f,goToOrder:O,removeCartItem:H,addToCart:z,getProducts:j,getCartList:w,updateCart:K,slidesPerView:S}},components:{Swiper:X,SwiperSlide:G,ToastMessages:rt}},ht=t("img",{src:ct,width:"500",alt:"loading",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},null,-1),bt=t("div",{class:"container mt-7 p-0"},[t("nav",{"aria-label":"breadcrumb"},[t("ol",{class:"breadcrumb"},[t("li",{class:"breadcrumb-item active","aria-current":"page"},"購物車")])])],-1),mt={class:"container mt-5"},gt={key:0,class:"row"},yt={class:"table align-middle border-lightBrown pc"},ft=t("thead",null,[t("tr",{class:"text-center"},[t("th",{width:"200"},"商品名稱"),t("th",{width:"120"},"單價"),t("th",{width:"200",class:"text-center"},"數量"),t("th",{width:"200"},"小計"),t("th",{width:"100"},"刪除")])],-1),wt={class:"text-center"},vt=["src"],Ct={class:"input-group w-100"},xt=["disabled","onClick"],kt=t("span",{style:{height:"16px",width:"16px"}},"-",-1),Tt=[kt],It=["onClick"],Vt=t("span",{style:{height:"16px",width:"16px"}},[t("i",{class:"bi bi-trash"})],-1),qt=[Vt],Pt=["onUpdate:modelValue","disabled"],St=["onClick"],Bt=t("span",{style:{height:"16px",width:"16px"}},"+",-1),Mt=[Bt],Lt=["onClick"],$t={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Nt=t("i",{class:"bi bi-trash"},null,-1),Ut={class:"border-white"},jt=t("td",null,null,-1),Et={colspan:"2",class:"pt-4 p-0"},Dt=t("i",{class:"bi bi-ticket-perforated fs-2 text-brown pe-3"},null,-1),Rt=t("option",{value:"",disabled:""},"請輸入優惠券",-1),At=t("option",{value:"newMember20%"},"新會員首購八折優惠",-1),Ft=t("option",{value:"purchasesover200010%"}," 滿兩千享九折優惠 ",-1),Ot=[Rt,At,Ft],Qt={type:"submit",class:"btn btn-outline-brown border-lightBrown ms-3 p-2"},zt={key:0,src:R,alt:"loading",width:"20"},Ht=t("td",null,null,-1),Kt={class:"text-black mt-3 pe-7 text-end fs-5"},Jt={class:"border-white"},Wt=t("td",null,null,-1),Xt=t("td",null,null,-1),Gt=t("td",null,null,-1),Yt=t("td",null,null,-1),Zt={class:"p-3"},te={class:"d-flex justify-content-center align-items-center p-0"},ee={class:"d-flex justify-content-center align-items-center p-0",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #e9b888"}},oe={class:"mobile"},se={class:"row"},ne={class:"col-3"},ie=["src"],le={class:"col-4"},de={class:"col-5"},ae={class:"input-group w-100 pt-4"},re=["disabled","onClick"],ce=t("span",{style:{height:"16px",width:"16px"}},"-",-1),ue=[ce],_e=["onClick"],pe=t("span",{style:{height:"16px",width:"16px"}},[t("i",{class:"bi bi-trash"})],-1),he=[pe],be=["onUpdate:modelValue","disabled"],me=["onClick"],ge=t("span",{style:{height:"16px",width:"16px"}},"+",-1),ye=[ge],fe={class:"border-top border-lightBrown p-3 bg-white"},we=t("i",{class:"bi bi-ticket-perforated fs-1 text-brown pe-1"},null,-1),ve=t("option",{value:"",disabled:""},"請輸入優惠券",-1),Ce=t("option",{value:"newMember20%"},"新會員首購八折優惠",-1),xe=t("option",{value:"purchasesover200010%"},"滿兩千享九折優惠",-1),ke=[ve,Ce,xe],Te={type:"submit",class:"btn btn-outline-brown border-lightBrown p-2"},Ie={key:0,src:R,alt:"loading",width:"20"},Ve={class:"text-black text-end mt-3 fs-5"},qe={class:"d-flex justify-content-end align-items-center my-4"},Pe={class:"d-flex justify-content-center align-items-center p-0",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #e9b888"}},Se={key:1,class:"text-center mb-8"},Be=t("img",{src:ut,class:"img-fluid object-fit-cover",alt:"emptycartpicture",style:{width:"300px",height:"350px"}},null,-1),Me={class:"text-brown fs-5"},Le=t("br",null,null,-1),$e={class:"container mt-8 p-0"},Ne=t("h3",{class:"text-center text-brown"},[y(" 猜你喜歡 "),t("div",{class:"text-center text-brown m-0 p-0 fs-1"},"-")],-1),Ue={id:"swiper"},je={class:"row"},Ee=["onClick"],De={key:0,class:"position-absolute top-0 start-0 fw-bold text-white p-2 bg-brown rounded-top"},Re=["src"],Ae={class:"card-body"},Fe={class:"card-title"},Oe={key:0,class:"text-gray2 fs-5 card-title text-center"},Qe={key:1,class:"d-flex align-items-center justify-content-center card-title ms-2"},ze={class:"text-gray2 fs-5"},He={class:"text-brown fs-5 ms-3"},Ke=t("br",null,null,-1),Je=["onClick"],We={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Xe=t("i",{class:"bi bi-cart-plus"},null,-1);function Ge(d,n,q,o,N,U){const _=x("VueLoading"),p=x("RouterLink"),T=x("swiper-slide"),P=x("swiper"),b=x("ToastMessages");return i(),l("div",null,[v(_,{active:o.isLoading,"is-full-page":!0,"background-color":"#FFF8F1",opacity:1,"z-index":1060},{default:C(()=>[ht]),_:1},8,["active"]),bt,t("div",mt,[o.carts.total!==0?(i(),l("div",gt,[t("table",yt,[ft,t("tbody",wt,[(i(!0),l(M,null,L(o.carts.carts,e=>(i(),l("tr",{key:e.id},[t("td",null,[t("div",null,[t("img",{src:e.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,vt)]),v(p,{class:"text-decoration-none text-black",to:`/product/${e.product.id}`},{default:C(()=>[y(u(e.product.title),1)]),_:2},1032,["to"])]),t("td",null,"$"+u(d.$filters.numberToCurrencyNo(e.product.price)),1),t("td",null,[t("div",Ct,[e.qty>1?(i(),l("button",{key:0,type:"button",class:"btn btn-outline-lightBrown",disabled:e.qty===1,onClick:a=>{e.qty--,o.changeCartQty(e,e.qty)}},Tt,8,xt)):(i(),l("button",{key:1,type:"button",class:"btn btn-outline-brown border-lightBrown",onClick:a=>o.removeCartItem(e.id)},qt,8,It)),V(t("input",{"onUpdate:modelValue":a=>e.qty=a,type:"number",min:"1",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:e.productId===o.status.loadingItem},null,8,Pt),[[D,e.qty]]),t("button",{type:"button",class:"btn btn-outline-lightBrown",onClick:a=>{e.qty++,o.changeCartQty(e,e.qty)}},Mt,8,St)])]),t("td",null,"$"+u(d.$filters.numberToCurrencyNo(e.total)),1),t("td",null,[t("button",{class:"btn btn-outline-brown border-0",onClick:a=>o.removeCartItem(e.id)},[e.id===o.status.loadingItem?(i(),l("span",$t)):k("",!0),Nt],8,Lt)])]))),128))]),t("tfoot",null,[t("tr",Ut,[jt,t("td",Et,[t("form",{onSubmit:n[1]||(n[1]=$((...e)=>o.addCouponCode&&o.addCouponCode(...e),["prevent"])),class:"d-flex align-items-center justify-content-end"},[Dt,V(t("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded w-50 p-2 fs-6","onUpdate:modelValue":n[0]||(n[0]=e=>o.coupon_code=e)},Ot,512),[[E,o.coupon_code]]),t("button",Qt,[t("span",null,[o.isLoadingCoupon?(i(),l("img",zt)):k("",!0)]),y(" 套用 ")])],32)]),Ht,t("td",null,[t("div",Kt," 總計：$"+u(d.$filters.numberToCurrencyNo(o.carts.total))+"元 ",1)])]),t("tr",Jt,[Wt,Xt,Gt,Yt,t("td",Zt,[t("div",te,[t("div",ee,[t("a",{class:"loginbtn text-center bg-brown d-block",onClick:n[2]||(n[2]=(...e)=>o.goToOrder&&o.goToOrder(...e))},"立即結帳")])])])])])]),t("div",oe,[(i(!0),l(M,null,L(o.carts.carts,e=>(i(),l("div",{class:"border-top border-lightBrown p-3 bg-white",key:e.id},[t("div",se,[t("div",ne,[t("img",{src:e.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,ie)]),t("div",le,[v(p,{class:"text-decoration-none text-black",to:`/product/${e.product.id}`},{default:C(()=>[y(u(e.product.title),1)]),_:2},1032,["to"]),t("div",null," $"+u(d.$filters.numberToCurrencyNo(e.total)),1)]),t("div",de,[t("div",ae,[e.qty>1?(i(),l("button",{key:0,type:"button",class:"btn btn-outline-lightBrown",disabled:e.qty===1,onClick:a=>{e.qty--,o.changeCartQty(e,e.qty)}},ue,8,re)):(i(),l("button",{key:1,type:"button",class:"btn btn-outline-brown border-lightBrown",onClick:a=>o.removeCartItem(e.id)},he,8,_e)),V(t("input",{"onUpdate:modelValue":a=>e.qty=a,type:"number",min:"1",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:e.productId===o.status.loadingItem},null,8,be),[[D,e.qty]]),t("button",{type:"button",class:"btn btn-outline-lightBrown",onClick:a=>{e.qty++,o.changeCartQty(e,e.qty)}},ye,8,me)])])])]))),128)),t("div",fe,[t("form",{onSubmit:n[4]||(n[4]=$((...e)=>o.addCouponCode&&o.addCouponCode(...e),["prevent"])),class:"d-flex align-items-center justify-content-between"},[we,V(t("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded p-2 fs-6","onUpdate:modelValue":n[3]||(n[3]=e=>o.coupon_code=e)},ke,512),[[E,o.coupon_code]]),t("button",Te,[t("span",null,[o.isLoadingCoupon?(i(),l("img",Ie)):k("",!0)]),y(" 套用 ")])],32),t("div",Ve," 總計：$"+u(d.$filters.numberToCurrencyNo(o.carts.total))+"元 ",1),t("div",qe,[t("div",Pe,[t("a",{class:"loginbtn text-center bg-brown d-block",onClick:n[5]||(n[5]=(...e)=>o.goToOrder&&o.goToOrder(...e))},"立即結帳")])])])])])):(i(),l("div",Se,[Be,t("div",Me,[y(" 購物車還沒有商品呦~ "),Le,v(p,{to:"/products",class:"btn btn-brown text-decoration-none m-3",onclick:"window.scrollTo(0, 0)"},{default:C(()=>[y("按我去選購")]),_:1})])]))]),t("div",$e,[Ne,t("div",Ue,[v(P,{slidesPerView:o.slidesPerView,grabCursor:!0,spaceBetween:30,pagination:{clickable:!0},freeMode:!0,modules:o.modules,class:"mySwiper",mousewheel:!0,keyboard:!0},{default:C(()=>[(i(!0),l(M,null,L(o.products,e=>(i(),lt(T,{key:e.id},{default:C(()=>[t("div",je,[t("div",{class:"card shadow-sm bg-body rounded-lg border-0 position-relative mb-3 col-12 ms-3 p-0",onClick:a=>o.openModal(e)},[e.price!==e.origin_price?(i(),l("span",De,"SALE")):k("",!0),t("img",{src:e.imageUrl,class:"card-img-top object-fit-cover w-100",style:{height:"300px"},alt:"productPicture"},null,8,Re),t("div",Ae,[t("p",Fe,u(e.title),1),e.price===e.origin_price?(i(),l("div",Oe," $"+u(d.$filters.numberToCurrencyNo(e.origin_price)),1)):(i(),l("div",Qe,[t("del",ze,"$"+u(d.$filters.numberToCurrencyNo(e.origin_price)),1),t("div",He," $"+u(d.$filters.numberToCurrencyNo(e.price)),1)])),Ke,t("button",{type:"button",class:"btn btn-outline-brown border-0 fs-5 m-2 position-absolute bottom-0 end-0",onClick:$(a=>o.addToCart(e.id,1),["stop"])},[e.id===o.status.loadingItem?(i(),l("span",We)):k("",!0),Xe],8,Je)])],8,Ee)])]),_:2},1024))),128))]),_:1},8,["slidesPerView","modules"])])]),v(b)])}const lo=tt(pt,[["render",Ge]]);export{lo as default};
