import{a as b}from"./axios-G2rPRu76.js";import{u as A}from"./toastMessage-JJTYryMe.js";import{_ as E}from"./CouponModal-enfd2paP.js";import{_ as T}from"./DelModal-EM7vTxLs.js";import{g as l,r as x,o as i,c as r,b as g,a as e,F as D,n as L,t as y}from"./index-VSSUrm_l.js";import"./useModal-V5AxtQjQ.js";var w={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week8/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const S={class:"text-end mt-4"},I={class:"table mt-4"},B=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),U={key:0,class:"text-success"},N={key:1,class:"text-muted"},O={class:"btn-group"},F=["onClick"],H=["onClick"],W={__name:"AdminCouponView",props:{config:Object},setup(j){const C=A(),{pushMessage:u}=C,m=l(null),f=l(null),$=l({}),a=l({title:"",is_enabled:0,percent:100,code:""}),p=l(!1),o=l(!1),{VITE_APP_URL:_,VITE_APP_PATH:v}=w,M=(t,n)=>{p.value=t,p.value?a.value={due_date:new Date().getTime()/1e3}:a.value={...n},m.value.openModal()},k=t=>{a.value={...t},f.value.openModal()},h=()=>{o.value=!0,b.get(`${_}/api/${v}/admin/coupons`).then(t=>{$.value=t.data.coupons,o.value=!1}).catch(t=>{o.value=!1,u({style:"danger",title:"錯誤訊息",content:t.response.data.message})})},P=t=>{o.value=!0;let n=`${_}/api/${v}/admin/coupon`,c="post",s=t;p.value||(n=`${_}/api/${v}/admin/coupon/${t.id}`,c="put",s=t),b[c](n,{data:s}).then(d=>{o.value=!1,u({style:"success",title:"新增優惠券",content:d.data.message}),h(),m.value.hideModal(),console.log(t)}).catch(d=>{o.value=!1,u({style:"danger",title:"錯誤訊息",content:d.response.data.message})})},V=()=>{const t=`${_}/api/${v}/admin/coupon/${a.value.id}`;o.value=!0,b.delete(t).then(n=>{o.value=!1,u({style:"success",title:"刪除優惠券",content:n.data.message}),f.value.hideModal(),h()}).catch(n=>{o.value=!1,u({style:"danger",title:"刪除優惠券",content:n.response.data.message})})};return h(),(t,n)=>{const c=x("VueLoading");return i(),r("div",null,[g(c,{active:o.value,"z-index":1060},null,8,["active"]),e("div",S,[e("button",{class:"btn btn-primary",type:"button",onClick:n[0]||(n[0]=s=>M(!0))}," 建立新的優惠券 ")]),e("table",I,[B,e("tbody",null,[(i(!0),r(D,null,L($.value,(s,d)=>(i(),r("tr",{key:d},[e("td",null,y(s.title),1),e("td",null,y(s.percent)+"%",1),e("td",null,y(t.$filters.date(s.due_date)),1),e("td",null,[s.is_enabled===1?(i(),r("span",U,"啟用")):(i(),r("span",N,"未啟用"))]),e("td",null,[e("div",O,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:R=>M(!1,s)},"編輯",8,F),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:R=>k(s)},"刪除",8,H)])])]))),128))])]),g(E,{coupon:a.value,"is-new":p.value,ref_key:"couponModalRef",ref:m,onUpdateCoupon:P},null,8,["coupon","is-new"]),g(T,{item:a.value,ref_key:"delModalRef",ref:f,onDelItem:V},null,8,["item"])])}}};export{W as default};
